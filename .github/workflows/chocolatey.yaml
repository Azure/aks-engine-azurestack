
name: Package Managers
on:
  workflow_dispatch:
    inputs:
      release_version:
        description: 'release tag'
        required: true
jobs:
  chocolatey:
    runs-on: windows-latest
    steps:
      - uses: actions/checkout@v3
      - name: set env
        run: |
          $ReleaseVersion = "${{github.event.inputs.release_version}}".substring(1)
          "ReleaseVersion=$ReleaseVersion" >> $env:GITHUB_ENV
      - name: choco stuff
        run: |
          cd .choco\aks-engine-azurestack
          choco install --yes au # https://github.com/majkinetor/au
          .\update.ps1
          choco pack
          choco apikey --api-key ${{ secrets.CHOCO_API_KEY }} -source https://push.chocolatey.org/
          choco push --source https://push.chocolatey.org/